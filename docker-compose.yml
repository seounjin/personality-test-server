version: "3"   

services:
  express:
      environment:
        - MONGODB_URI
      build:
        context: ./server
        dockerfile: "Dockerfile"
      container_name: express

  nginx:
    image: nginx:latest
    restart: "unless-stopped" 
    # build:
    #   context: ./nginx
    #   dockerfile: "Dockerfile"
    ports:
      - 80:80
      - 443:443
    container_name: nginx
    env_file:
      - .env
    # volumes:
      # - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      # - ./nginx/templates/default.conf.template:/etc/nginx/templates/default.conf.template
      # - ./nginx/templates/default.conf.template:/etc/nginx/conf.d/default.conf.template
    #environment:
      #- SERVER_DOMAIN=$SERVER_DOMAIN
    command: /bin/bash -c "envsubst < /etc/nginx/conf.d/default.conf.template > /etc/nginx/nginx.conf && exec nginx -g 'daemon off;'"
    